# 칵테일 암호 관리

k8s cluster를 어떤 이유로 재설치 경우, etcd snapshot과 cocktail cmdb, builderdb를 restore하여 기존 상태로 복원하는 절차를 기술한다.

이때, 반드시 etcd 인증서는 기존 인증서를 사용해야 하며, 그렇지 않을 경우 복원할 수 없다.

* etcd 인증서 디렉토리: /etc/kubernets/pki
* etcd 설정파일: /etc/etcd/etcd.conf

**1.칵테일 로그인 암호 관리.**

아래와 같이 etcd snapshot 생성, cocktail db backup을 위한 shell script를 자신의 환경에 맞게 수정한 후 backup을 주기적으로 실시한다.

1\) 칵테일 암호 관리 대상은 cocktail이 설치된 모든 cluster 및 hosting service이다.

2\) 암호는 "영문대소문자 + 특수기호\(!@\#$%^&\*=+-\__\)_ + 숫자" 조합으로 최소 8자 이상 최대 24자리까지 생성 가능하다.

3\) 암호 변경 주기는 90일이며, 90일이 지나서 cocktail에 로그인할 경우 암호 변경 화면이 표시된다. 암호 변경화면에서 "다음에 변경하기"를 선택하면 기존 암호로 cocktail을 사용할 수 있지만, 재 로그인시마다 암호 변경화면이 표시된다.

**2.Image registry 로그인 암호**

Cocktail 설치 시에 Cocktail Private Hub를 설치한 경우에 admin의 암호는 외부 노출이 되지 않도록 운영자가 잘 관리해야 한다. 왜냐하면, 해당 admin의 암호는 cocktail api server에서 환경변수로 등록하여 registry 접속여부 확인, project 등록, 사용자 등록, project에 사용자 mapping, 이미지 정보기능 등의 기능 을 수행함으로 이를 변경하면 api server가 다시 환경변수를 읽어드려야 함으로 반드시 재시작이 필요하다.



2\) 부득이 암호를 변경할 경우에는 사전에 메일을 통해 담당 서비스팀으로 요청하여 안내를 받도록 해야 한다.



