# Update k8s cluster certificate

Kubernetes를 구성하는 각 컴포넌트들도 내부 인증서를 통해 통신한다. 필요에 의해 이 인증서를 update해야 하는 경우 아래의 절차대로 수행한다.

**1.먼저 각 master node와 worker node의 기존 인증서를 삭제한다.**

```
# ssh to master node
# rm -rf /opt/kubernetes/pki
# rm -rf /etc/kubernetes/pki


# kubectl get secrets --all-namespaces | grep default-token | awk '{print $1, $2}' | xargs -n 2 kubectl delete secrets -n
```

2**.인증서를 재 생성한다.**

```
# cd cubescripts
# ansible-playbook -i inventories/inventory -u root cert.yaml
```



3**.k8s에 생성된 default token를 모두 삭제한다.**

```
# kubectl get secrets --all-namespaces | grep default-token | awk '{print $1, $2}' | xargs -n 2 kubectl delete secrets -n
```

4**. Worker node -&gt; Master Node 순으로 rebooting한다.**

```

```



